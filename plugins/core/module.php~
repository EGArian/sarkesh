<?php
class core_module{
	private $view;
	private $db;
	private $user;
	function __construct(){
		$this->view = new core_view;
		$this->db = new cls_database;
		$this->user = new users_module;
	}

	public function show_core_page($content){
		
		$this->view->show_core_page($this->get_plugins_menu(), $content);
	
	}
	
	//this function return all contents that return from admin_menu function in controller class of all plugins
	//it's most use for return plugin menu for show in admin panel
	public function get_plugins_menu(){
		//first get all active plugins
		$this->db->do_query('SELECT * FROM ' . TablePrefix . "plugins WHERE enable=1;");
		$plugins = $this->db->get_array();
		//this varible store all menus back from plugins->admin_menu()
		$menus = null;
		foreach($plugins as $plugin){
			$plugin_name = $plugin['name'] . '_controller';
			$plugin_object = new $plugin_name;
			if(method_exists($plugin_object, 'admin_menu')){
			      $menus[] = $plugin_object->admin_menu();
			}
		}
		return $menus;
	
	}
	//this function return plugins info
	//if active = false then it send back all plugins and else return just activated plugins
	public function get_plugins($active = true){
		if($active){
			$this->db->do_query('SELECT * FROM ' . TablePrefix . 'plugins WHERE enable=1;');
		}
		else{
			$this->db->do_query('SELECT * FROM ' . TablePrefix . 'plugins;');
		}
		return $this->db->get_array();
	}
	//this function return active theme that is set on site
	public function active_theme(){
		$registry = new cls_registry;
		return $registry->get('core', 'active_theme');
	}
}
?>